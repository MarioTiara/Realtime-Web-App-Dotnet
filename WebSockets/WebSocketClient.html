<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket JavaScript Client</title>
</head>
<body>
    <h1>WebSocket JavaScript Client</h1>
    <p id="stateLabel">Ready to connect</p>
    <p id ="connIDLabel"></p>
    <div>
        <label for="connectionUrl">WebSocket Server Url:</label>
        <input id="connectionUrl"/>
        <button id="connectButton" type="submit">Connect</button>
        <button id="closeButton" disabled > Close Socket</button>
    </div>
    <p></p>
    <div>
        <label for="sendessage">Message:</label>
        <input id="sendMessage" disabled/>
        <button id="sendButton" type="submit" disabled>Send</button>
    </div>
    <p></p>
    <div>
        <label for="recipents">Recipent ID:</label>
        <input id="recipents" disabled />
    </div>
    <p></p>
    <h2>Communication Log</h2>
    <table style="width: 800px;">
        <thead>
            <tr>
                <td style="width: 100px;">From</td>
                <td style="width: 100px;">To</td>
            </tr>
        </thead>
        <tbody id="coomsLog">

        </tbody>
    </table>
</body>
<script>
     var connectionUrl= document.getElementById("connectionUrl");
     var connectButton= document.getElementById("connectButton")
     var stateLabel=document.getElementById("stateLabel");
     var sendMessage=document.getElementById("sendMessage");
     var sendButton=document.getElementById("sendButton");
     var coomsLog=document.getElementById("coomsLog");
     var closeButton=document.getElementById("closeButton");
     var recipents=document.getElementById("recipents");
     var connId=document.getElementById("connIDLabel");

     connectionUrl.value="ws://localhost:54809";
     connectButton.onclick= function(){
        stateLabel.innerHTML="Attempting to connect...";
        Socket=new WebSocket(connectionUrl.value);
        Socket.onopen= function (event){
            updateState();
            coomsLog.innerHTML +='<tr>'+
                '<td colspan="3">Connection opened</td>'+
                '</tr>'
        };
        Socket.onclose=function(event){
            updateState();
            coomsLog.innerHTML +='<tr>'+
                '<td colspan="3">Connection closed. Code: '+htmlEscape(event.code)+
                +'Reason: '+htmlEscape(event.reason)+'</td>'+
                '</tr>';
        }

        Socket.onerror=updateState();
        Socket.onmessage= function (event){
            coomsLog.innerHTML+='<tr>'+
            '<td>Server</td>'+
            '<td>Client</td>'+
            '<td>'+htmlEscape(event.data) +'</td>'+ '</tr>';
        };

        
        
     };

     function htmlEscape(str){
            return str.toString()
            .replace(/&/g,'&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g,'&#39;')
            .replace(/</g,'&lt;')
            .replace(/>/g,'&gt');
       };

      function updateState(){
        function disable(){
            sendMessage.disable=true;
            sendButton.disable=true;
            closeButton.disable=true;
            recipents.disable=true;
        }
        function enable(){
            sendMessage.disable=false;
            sendButton.disable=false;
            closeButton.disable=false;
            recipents.disable=false;
        }
        connectionUrl.disable=true;
        connectButton.disable=true;
        if (!Socket){
            disable();
        }else{
            switch(Socket.readyState){
                case WebSocket.CLOSED:
                    stateLabel.innerHTML="Closed";
                    connId.innerHTML="ConnID: N/a";
                    disable();
                    connectionUrl.disable=false;
                    connectButton.disable=false;
                    break;
                case WebSocket.CLOSING:
                    stateLabel.innerHTML="Closing...";
                    disable();
                    break;
                case WebSocket.OPEN:
                    stateLabel.innerHTML="Open";
                    enable();
                    break;
                default:
                    stateLabel.innerHTML="Unknown WebSocket State: "+htmlEscape(Socket.readyState);
            }
        }

      };



   

   
      
</script>
</html>